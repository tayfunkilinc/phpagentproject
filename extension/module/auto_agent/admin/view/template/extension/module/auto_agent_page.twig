{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <h1>{{ heading_title }}</h1>
    </div>
  </div>

  <div class="container-fluid">
    <div class="card">
      <div class="card-body">
        <div class="mb-3">
          <label for="productSelect" class="form-label">Select Product</label>
          <select id="productSelect" class="form-select">
            {% for product in products %}
              <option value="{{ product.product_id }}">{{ product.name }}</option>
            {% endfor %}
          </select>
        </div>

        <button id="generateBtn" class="btn btn-primary">Generate Description</button>
        <div id="result" class="mt-4"></div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('generateBtn').addEventListener('click', function() {
  const id = document.getElementById('productSelect').value;
  const result = document.getElementById('result');
  result.innerHTML = '<div class="alert alert-info">Generating description...</div>';

  fetch('{{ action_generate }}', {
    method: 'POST',
    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
    body: 'product_id=' + id
  })
  .then(r => r.json())
  .then(data => {
    if (data.description) {
      result.innerHTML = '<div class="alert alert-success"><b>Generated Description:</b><br><br><pre>' 
        + data.description + '</pre></div>';
    } else if (data.error) {
      result.innerHTML = '<div class="alert alert-danger">' + data.error + '</div>';
    } else {
      result.innerHTML = '<div class="alert alert-warning">Unexpected response.</div>';
    }
  })
  .catch(() => {
    result.innerHTML = '<div class="alert alert-danger">Failed to reach API.</div>';
  });
});
</script>
{{ footer }}